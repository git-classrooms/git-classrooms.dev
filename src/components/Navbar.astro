---
import { type Locale, locales, localeLabels, useTranslations } from "../i18n";

interface Props {
  locale: Locale;
}

const { locale } = Astro.props;
const t = useTranslations(locale);
---

<nav class="fixed top-0 left-0 right-0 z-50 glass">
  <div class="mx-auto max-w-6xl px-6 py-4 flex items-center justify-between">
    <a href={`/${locale}/`} class="flex items-center gap-3 group">
      <div class="relative">
        <div
          class="w-8 h-8 rounded-md bg-primary/10 border border-primary/30 flex items-center justify-center group-hover:glow-sm transition-shadow duration-300"
        >
          <svg viewBox="0 0 24 24" fill="none" class="w-4 h-4" stroke-width="1.8" stroke-linecap="round">
            <path d="M12 2 L12 6" class="stroke-primary" />
            <path d="M12 6 L6 12" class="stroke-primary" />
            <path d="M12 6 L18 12" class="stroke-primary" />
            <path d="M6 12 L12 18" class="stroke-[hsl(280,100%,60%)]" />
            <path d="M18 12 L12 18" class="stroke-[hsl(280,100%,60%)]" />
            <path d="M12 18 L12 22" class="stroke-[hsl(280,100%,60%)]" />
            <circle cx="12" cy="6" r="1.8" class="fill-primary" />
            <circle cx="6" cy="12" r="1.8" class="fill-primary" opacity="0.8" />
            <circle cx="18" cy="12" r="1.8" class="fill-[hsl(280,100%,60%)]" opacity="0.8" />
            <circle cx="12" cy="18" r="1.8" class="fill-[hsl(280,100%,60%)]" />
          </svg>
        </div>
      </div>
      <span class="font-mono font-semibold text-sm tracking-tight">
        <span class="text-primary">git</span><span class="text-muted">-</span
        >classrooms
      </span>
    </a>

    <div class="hidden md:flex items-center gap-8">
      <a
        href="#features"
        class="text-sm text-muted hover:text-foreground transition-colors duration-200"
        >{t.nav.features}</a
      >
      <a
        href="#how-it-works"
        class="text-sm text-muted hover:text-foreground transition-colors duration-200"
        >{t.nav.howItWorks}</a
      >
      <a
        href="#tech-stack"
        class="text-sm text-muted hover:text-foreground transition-colors duration-200"
        >{t.nav.techStack}</a
      >

      <!-- Language switcher — git branch metaphor -->
      <div class="relative" id="lang-switcher">
        <button
          id="lang-btn"
          class="group/lang inline-flex items-center gap-1.5 py-1.5 font-mono text-xs text-muted hover:text-foreground transition-colors duration-200"
          aria-expanded="false"
          aria-haspopup="true"
        >
          <!-- git branch icon -->
          <svg class="w-3.5 h-3.5 text-primary/70 group-hover/lang:text-primary transition-colors duration-200" viewBox="0 0 16 16" fill="currentColor">
            <path d="M11.75 2.5a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5zm-2.25.75a2.25 2.25 0 1 1 3 2.122V6A2.5 2.5 0 0 1 10 8.5H6a1 1 0 0 0-1 1v1.128a2.251 2.251 0 1 1-1.5 0V5.372a2.25 2.25 0 1 1 1.5 0v1.836A2.493 2.493 0 0 1 6 7h4a1 1 0 0 0 1-1v-.628A2.25 2.25 0 0 1 9.5 3.25zM4.25 12a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5zM3.5 3.25a.75.75 0 1 0 1.5 0 .75.75 0 0 0-1.5 0z" />
          </svg>
          <span class="tracking-wide">{localeLabels[locale].short.toLowerCase()}</span>
          <svg class="w-3 h-3 opacity-40 transition-transform duration-200 lang-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M6 9l6 6 6-6" />
          </svg>
        </button>

        <div
          id="lang-dropdown"
          class="absolute right-0 top-full mt-3 origin-top-right scale-95 opacity-0 invisible transition-all duration-200 ease-out"
        >
          <!-- Notch arrow -->
          <div class="absolute -top-1.5 right-4 w-3 h-3 rotate-45 bg-[hsl(220_16%_11%)] border-l border-t border-[hsl(220_16%_20%)]"></div>

          <div class="relative rounded-xl overflow-hidden bg-[hsl(220_16%_11%)] backdrop-blur-xl border border-[hsl(220_16%_20%)] shadow-xl shadow-black/40">
            <div class="px-3 pt-2.5 pb-1.5">
              <span class="text-[10px] font-mono uppercase tracking-widest text-muted/40">checkout</span>
            </div>
            <div class="px-1.5 pb-1.5">
              {locales.map((l) => (
                <a
                  href={`/${l}/`}
                  class:list={[
                    "group/item flex items-center gap-3 px-2.5 py-2 rounded-lg font-mono text-[13px] transition-all duration-150",
                    l === locale
                      ? "text-foreground"
                      : "text-muted hover:text-foreground hover:bg-white/[0.04]",
                  ]}
                  aria-current={l === locale ? "page" : undefined}
                >
                  <!-- Active indicator: asterisk like git branch output -->
                  <span class:list={[
                    "w-3 text-center text-xs",
                    l === locale ? "text-primary" : "opacity-0",
                  ]}>*</span>
                  <span class="flex-1">{localeLabels[l].name}</span>
                  <span class:list={[
                    "text-[11px] tabular-nums",
                    l === locale ? "text-primary/50" : "text-muted/30",
                  ]}>{localeLabels[l].short}</span>
                </a>
              ))}
            </div>
          </div>
        </div>
      </div>

      <a
        href="https://github.com/git-classrooms"
        target="_blank"
        rel="noopener noreferrer"
        class="inline-flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-lg bg-primary/10 text-primary border border-primary/20 hover:bg-primary/20 hover:border-primary/40 transition-all duration-200"
      >
        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
          <path
            d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"
          ></path>
        </svg>
        GitHub
      </a>
    </div>

    <button
      id="mobile-menu-btn"
      class="md:hidden p-2 text-muted hover:text-foreground transition-colors"
      aria-label="Toggle menu"
    >
      <svg
        class="w-5 h-5"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        stroke-width="2"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
    </button>
  </div>

  <div id="mobile-menu" class="hidden md:hidden border-t border-border/50">
    <div class="px-6 py-4 flex flex-col gap-4">
      <a
        href="#features"
        class="text-sm text-muted hover:text-foreground transition-colors"
        >{t.nav.features}</a
      >
      <a
        href="#how-it-works"
        class="text-sm text-muted hover:text-foreground transition-colors"
        >{t.nav.howItWorks}</a
      >
      <a
        href="#tech-stack"
        class="text-sm text-muted hover:text-foreground transition-colors"
        >{t.nav.techStack}</a
      >
      <!-- Mobile language section — git branch style -->
      <div class="pt-2 border-t border-border/30">
        <div class="flex items-center gap-1.5 mb-2">
          <svg class="w-3 h-3 text-primary/50" viewBox="0 0 16 16" fill="currentColor">
            <path d="M11.75 2.5a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5zm-2.25.75a2.25 2.25 0 1 1 3 2.122V6A2.5 2.5 0 0 1 10 8.5H6a1 1 0 0 0-1 1v1.128a2.251 2.251 0 1 1-1.5 0V5.372a2.25 2.25 0 1 1 1.5 0v1.836A2.493 2.493 0 0 1 6 7h4a1 1 0 0 0 1-1v-.628A2.25 2.25 0 0 1 9.5 3.25zM4.25 12a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5zM3.5 3.25a.75.75 0 1 0 1.5 0 .75.75 0 0 0-1.5 0z" />
          </svg>
          <span class="text-[10px] font-mono uppercase tracking-widest text-muted/40">checkout</span>
        </div>
        {locales.map((l) => (
          <a
            href={`/${l}/`}
            class:list={[
              "flex items-center gap-3 px-2 py-2 rounded-lg font-mono text-sm transition-colors duration-150",
              l === locale
                ? "text-foreground"
                : "text-muted hover:text-foreground hover:bg-white/[0.04]",
            ]}
            aria-current={l === locale ? "page" : undefined}
          >
            <span class:list={[
              "w-3 text-center text-xs",
              l === locale ? "text-primary" : "opacity-0",
            ]}>*</span>
            <span class="flex-1">{localeLabels[l].name}</span>
            <span class:list={[
              "text-xs",
              l === locale ? "text-primary/50" : "text-muted/30",
            ]}>{localeLabels[l].short}</span>
          </a>
        ))}
      </div>
      <a
        href="https://github.com/git-classrooms"
        target="_blank"
        rel="noopener noreferrer"
        class="inline-flex items-center gap-2 text-sm text-primary"
      >
        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
          <path
            d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"
          ></path>
        </svg>
        GitHub
      </a>
    </div>
  </div>
</nav>

<script>
  const mobileBtn = document.getElementById("mobile-menu-btn");
  const mobileMenu = document.getElementById("mobile-menu");
  mobileBtn?.addEventListener("click", () => mobileMenu?.classList.toggle("hidden"));
  mobileMenu?.querySelectorAll("a").forEach((link) => {
    link.addEventListener("click", () => mobileMenu?.classList.add("hidden"));
  });

  const langBtn = document.getElementById("lang-btn");
  const langDropdown = document.getElementById("lang-dropdown");
  const chevron = langBtn?.querySelector(".lang-chevron");

  function openDropdown() {
    langDropdown?.classList.remove("scale-95", "opacity-0", "invisible");
    langDropdown?.classList.add("scale-100", "opacity-100", "visible");
    chevron?.classList.add("rotate-180");
    langBtn?.setAttribute("aria-expanded", "true");
  }

  function closeDropdown() {
    langDropdown?.classList.add("scale-95", "opacity-0", "invisible");
    langDropdown?.classList.remove("scale-100", "opacity-100", "visible");
    chevron?.classList.remove("rotate-180");
    langBtn?.setAttribute("aria-expanded", "false");
  }

  langBtn?.addEventListener("click", (e) => {
    e.stopPropagation();
    const isOpen = langBtn.getAttribute("aria-expanded") === "true";
    isOpen ? closeDropdown() : openDropdown();
  });

  document.addEventListener("click", (e) => {
    if (!(e.target as HTMLElement)?.closest("#lang-switcher")) {
      closeDropdown();
    }
  });

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") closeDropdown();
  });
</script>
